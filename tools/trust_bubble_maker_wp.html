<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trust Bubble Maker [WP]</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.pumpkin.min.css" />
  <link rel="stylesheet" href="../styles.css" />
</head>
<body class="container">

  <h5>Paste the code here (from Code Editor on WP):</h5>
  <textarea id="inputHtml" style="height: 200px;"></textarea>

  <button class="within-frame-button" onclick="create_trust_bubbles()">Create Trust Bubbles</button>

  <h5>Paste the code from here to Code Editor on WP:</h5>
  <textarea id="outputHtml" readonly style="height: 200px;"></textarea>

  <h5>Log:</h5>
  <textarea id="logText" readonly style="height: 200px;"></textarea>

  <script>
    function toPlainText(html) {
      const div = document.createElement("div");
      div.innerHTML = html;
      return div.textContent || div.innerText || "";
    }

    function create_trust_bubbles() {
        const inputHTML = document.getElementById("inputHtml").value;

        const bubbleTemplates = {
          "PRO TIP": () => `<!-- wp:eneba/trust-bubbles {"bubbleType":"pro-tip"} -->
<div class="wp-block-eneba-trust-bubbles">
  <div class="wp-block-eneba-trust-bubbles">
    <div class="trust-bubbles-content">
      <div class="trust-bubble trust-bubble-pro-tip">
        <div class="bubble-type-label">Pro tip</div>
        <div class="bubble-content">
          <!-- wp:paragraph {"placeholder":"Enter your text or add a list..."} -->
          <p></p>
          <!-- /wp:paragraph -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /wp:eneba/trust-bubbles -->`,

          "WHY WE CHOSE IT": () => `<!-- wp:eneba/trust-bubbles -->
<div class="wp-block-eneba-trust-bubbles">
  <div class="wp-block-eneba-trust-bubbles">
    <div class="trust-bubbles-content">
      <div class="trust-bubble trust-bubble-why-we-chose">
        <div class="bubble-type-label">Why we chose it</div>
        <div class="bubble-content">
          <!-- wp:paragraph {"placeholder":"Enter your text or add a list..."} -->
          <p></p>
          <!-- /wp:paragraph -->
        </div>
      </div>
    </div>
  </div>
</div>
<!-- /wp:eneba/trust-bubbles -->`
        };

        const tableRegex = /<!-- wp:table -->(.*?)<!-- \/wp:table -->/gs;
        let logEntries = [];
        let replacements = 0;

        const outputHTML = inputHTML.replace(tableRegex, (match, innerTable, offset) => {
            const tdRegex = /<td>(.*?)<\/td>/is;
            const tdMatch = innerTable.match(tdRegex);

            if (!tdMatch) {
                logEntries.push(`Skipped table at position ${offset}: No <td> found.`);
                return match;
            }

            const titleKey = toPlainText(tdMatch[1]).trim().toUpperCase();
            const templateFn = bubbleTemplates[titleKey];

            if (!templateFn) {
                logEntries.push(`Skipped table at position ${offset}: Unrecognized bubble type "${tdMatch[1]}".`);
                return match;
            }

            replacements++;
            logEntries.push(`✅ Replaced table at position ${offset} → "${tdMatch[1]}"`);

            return templateFn();
        });

        document.getElementById("outputHtml").value = outputHTML;
        document.getElementById("logText").value =
          `Replacements: ${replacements}\n\n` + logEntries.join("\n");
    }
  </script>
  <script src="../js/iframe-auto-resizer.js"></script>
</body>
</html>
